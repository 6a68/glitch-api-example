(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({"/home/meandave/Code/glitch-fork/node_modules/browserify/node_modules/process/browser.js":[function(require,module,exports){
// shim for using process in browser

var process = module.exports = {};

process.nextTick = (function () {
    var canSetImmediate = typeof window !== 'undefined'
    && window.setImmediate;
    var canPost = typeof window !== 'undefined'
    && window.postMessage && window.addEventListener
    ;

    if (canSetImmediate) {
        return function (f) { return window.setImmediate(f) };
    }

    if (canPost) {
        var queue = [];
        window.addEventListener('message', function (ev) {
            var source = ev.source;
            if ((source === window || source === null) && ev.data === 'process-tick') {
                ev.stopPropagation();
                if (queue.length > 0) {
                    var fn = queue.shift();
                    fn();
                }
            }
        }, true);

        return function nextTick(fn) {
            queue.push(fn);
            window.postMessage('process-tick', '*');
        };
    }

    return function nextTick(fn) {
        setTimeout(fn, 0);
    };
})();

process.title = 'browser';
process.browser = true;
process.env = {};
process.argv = [];

function noop() {}

process.on = noop;
process.addListener = noop;
process.once = noop;
process.off = noop;
process.removeListener = noop;
process.removeAllListeners = noop;
process.emit = noop;

process.binding = function (name) {
    throw new Error('process.binding is not supported');
}

// TODO(shtylman)
process.cwd = function () { return '/' };
process.chdir = function (dir) {
    throw new Error('process.chdir is not supported');
};

},{}],"/home/meandave/Code/glitch-fork/node_modules/raf/index.js":[function(require,module,exports){
var now = require('performance-now')
  , global = typeof window === 'undefined' ? {} : window
  , vendors = ['moz', 'webkit']
  , suffix = 'AnimationFrame'
  , raf = global['request' + suffix]
  , caf = global['cancel' + suffix] || global['cancelRequest' + suffix]
  , native = true

for(var i = 0; i < vendors.length && !raf; i++) {
  raf = global[vendors[i] + 'Request' + suffix]
  caf = global[vendors[i] + 'Cancel' + suffix]
      || global[vendors[i] + 'CancelRequest' + suffix]
}

// Some versions of FF have rAF but not cAF
if(!raf || !caf) {
  native = false

  var last = 0
    , id = 0
    , queue = []
    , frameDuration = 1000 / 60

  raf = function(callback) {
    if(queue.length === 0) {
      var _now = now()
        , next = Math.max(0, frameDuration - (_now - last))
      last = next + _now
      setTimeout(function() {
        var cp = queue.slice(0)
        // Clear queue here to prevent
        // callbacks from appending listeners
        // to the current frame's queue
        queue.length = 0
        for(var i = 0; i < cp.length; i++) {
          if(!cp[i].cancelled) {
            try{
              cp[i].callback(last)
            } catch(e) {
              setTimeout(function() { throw e }, 0)
            }
          }
        }
      }, Math.round(next))
    }
    queue.push({
      handle: ++id,
      callback: callback,
      cancelled: false
    })
    return id
  }

  caf = function(handle) {
    for(var i = 0; i < queue.length; i++) {
      if(queue[i].handle === handle) {
        queue[i].cancelled = true
      }
    }
  }
}

module.exports = function(fn) {
  // Wrap in a new function to prevent
  // `cancel` potentially being assigned
  // to the native rAF function
  if(!native) {
    return raf.call(global, fn)
  }
  return raf.call(global, function() {
    try{
      fn.apply(this, arguments)
    } catch(e) {
      setTimeout(function() { throw e }, 0)
    }
  })
}
module.exports.cancel = function() {
  caf.apply(global, arguments)
}

},{"performance-now":"/home/meandave/Code/glitch-fork/node_modules/raf/node_modules/performance-now/lib/performance-now.js"}],"/home/meandave/Code/glitch-fork/node_modules/raf/node_modules/performance-now/lib/performance-now.js":[function(require,module,exports){
(function (process){
// Generated by CoffeeScript 1.6.3
(function() {
  var getNanoSeconds, hrtime, loadTime;

  if ((typeof performance !== "undefined" && performance !== null) && performance.now) {
    module.exports = function() {
      return performance.now();
    };
  } else if ((typeof process !== "undefined" && process !== null) && process.hrtime) {
    module.exports = function() {
      return (getNanoSeconds() - loadTime) / 1e6;
    };
    hrtime = process.hrtime;
    getNanoSeconds = function() {
      var hr;
      hr = hrtime();
      return hr[0] * 1e9 + hr[1];
    };
    loadTime = getNanoSeconds();
  } else if (Date.now) {
    module.exports = function() {
      return Date.now() - loadTime;
    };
    loadTime = Date.now();
  } else {
    module.exports = function() {
      return new Date().getTime() - loadTime;
    };
    loadTime = new Date().getTime();
  }

}).call(this);

/*
//@ sourceMappingURL=performance-now.map
*/

}).call(this,require('_process'))
},{"_process":"/home/meandave/Code/glitch-fork/node_modules/browserify/node_modules/process/browser.js"}],"/home/meandave/Code/glitch-fork/node_modules/spatial-noise/node_modules/float-bits/bits.js":[function(require,module,exports){
"use strict"

var FLOAT_VIEW  = new Float32Array(1)
  , INT_VIEW    = new Int32Array(FLOAT_VIEW.buffer)
  , UINT_VIEW   = new Uint32Array(FLOAT_VIEW.buffer)

function floatToInt(x) {
  FLOAT_VIEW[0] = x
  return INT_VIEW[0]
}

function intToFloat(x) {
  INT_VIEW[0] = x
  return FLOAT_VIEW[0]
}

function floatToUint(x) {
  FLOAT_VIEW[0] = x
  return UINT_VIEW[0]
}

function uintToFloat(x) {
  UINT_VIEW[0] = x
  return FLOAT_VIEW[0]
}

module.exports = floatToInt
module.exports.toInt = floatToInt
module.exports.fromInt = intToFloat
module.exports.toUint = floatToUint
module.exports.fromUint = uintToFloat
},{}],"/home/meandave/Code/glitch-fork/node_modules/spatial-noise/node_modules/hash-int/hashint.js":[function(require,module,exports){
"use strict"

var A
if(typeof Uint32Array === undefined) {
  A = [ 0 ]
} else {
  A = new Uint32Array(1)
}

function hashInt(x) {
  A[0]  = x|0
  A[0] -= (A[0]<<6)
  A[0] ^= (A[0]>>>17)
  A[0] -= (A[0]<<9)
  A[0] ^= (A[0]<<4)
  A[0] -= (A[0]<<3)
  A[0] ^= (A[0]<<10)
  A[0] ^= (A[0]>>>15)
  return A[0]
}

module.exports = hashInt

},{}],"/home/meandave/Code/glitch-fork/node_modules/spatial-noise/prng.js":[function(require,module,exports){
"use strict"

var hashInt       = require("hash-int")
  , float2Int     = require("float-bits").toInt
  , UINT_MAX      = 4294967295.0
  , HASH_CONSTANT = 0x7997F879
  , DOUBLE_VIEW   = new Float64Array(1)
  , INT_VIEW      = new Uint32Array(DOUBLE_VIEW.buffer)

function hashDouble(x, y) {
  DOUBLE_VIEW[0] = +x
  return hashInt(INT_VIEW[0] + hashInt(INT_VIEW[1]+y))
}

function noise1f(x) {
  return (+(hashInt(float2Int(x)+HASH_CONSTANT)>>>0)) / UINT_MAX
}

function noise2f(x, y) {
  return (+(hashInt(float2Int(y)+hashInt(float2Int(x)+HASH_CONSTANT))>>>0)) / UINT_MAX
}

function noise3f(x,y,z) {
  return (+(hashInt(float2Int(z)+hashInt(float2Int(y)+hashInt(float2Int(x)+HASH_CONSTANT)))>>>0)) / UINT_MAX
}

function noise4f(x,y,z,t) {
  return (+(hashInt(float2Int(t)+hashInt(float2Int(z)+hashInt(float2Int(y)+hashInt(float2Int(x)+HASH_CONSTANT)))>>>0))) / UINT_MAX
}

function noiseNf() {
  var n = arguments.length
    , r = HASH_CONSTANT
  for(var i=0; i<n; ++i) {
    r = hashInt(r + float2Int(arguments[i]))
  }
  return (+r) / UINT_MAX
}

function noise1d(x) {
  return +(hashDouble(x, HASH_CONSTANT)>>>0) / UINT_MAX
}

function noise2d(x, y) {
  return +(hashDouble(y, hashDouble(x, HASH_CONSTANT))>>>0) / UINT_MAX
}

function noise3d(x, y, z) {
  return +(hashDouble(z, hashDouble(y, hashDouble(x, HASH_CONSTANT)))>>>0) / UINT_MAX
}

function noise4d(x, y, z, t) {
  return +(hashDouble(t, hashDouble(z, hashDouble(y, hashDouble(x, HASH_CONSTANT))))>>>0) / UINT_MAX
}

function noiseNd() {
  var n = arguments.length
    , r = HASH_CONSTANT
  for(var i=0; i<n; ++i) {
    r = hashDouble(arguments[i], r)
  }
  return +(r>>>0) / UINT_MAX
}

module.exports         = noiseNd
module.exports.noise1d = noise1d
module.exports.noise2d = noise2d
module.exports.noise3d = noise3d
module.exports.noise4d = noise4d
module.exports.noiseNd = noiseNd
module.exports.noise1f = noise1f
module.exports.noise2f = noise2f
module.exports.noise3f = noise3f
module.exports.noise4f = noise4f
module.exports.noiseNf = noiseNf

},{"float-bits":"/home/meandave/Code/glitch-fork/node_modules/spatial-noise/node_modules/float-bits/bits.js","hash-int":"/home/meandave/Code/glitch-fork/node_modules/spatial-noise/node_modules/hash-int/hashint.js"}],"/home/meandave/Code/glitch-fork/public/js/main.js":[function(require,module,exports){
var sn = require("spatial-noise");
var raf = require('raf');

var file = document.querySelector('input[type=file]');
var submitBtn = document.querySelector('.submit')
var killswitch = document.querySelector('.kill');

var img = document.createElement('img');
var canvas = document.createElement("canvas");
canvas.id = 'noise';
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;
document.body.appendChild(canvas)

var context = canvas.getContext("2d")
var pixels = context.getImageData(0, 0, canvas.width, canvas.height)

var payload = {}
var killed = false;

var noiseInterval = setInterval(function() {
  var spread = Math.floor(Math.random()*20);
  killswitch.style['box-shadow'] = '11px 2px 15px '+spread+'px #FE0C0C';
}, 500);

var submitHandler = function(e){
  e.preventDefault()
  var xhr = new XMLHttpRequest()
  xhr.onreadystatechange = function(){
    var parsed;
    if (xhr.readyState === 4) {
      parsed = JSON.parse(xhr.responseText)
      img.src = parsed.content;
    }
  }
  xhr.open('POST', '/service')
  xhr.setRequestHeader('Content-Type', 'application/json')
  if (payload.content) xhr.send(JSON.stringify(payload));
}

var fileHandler = function(e) {
  var reader = new FileReader()
  reader.onloadend = function() {
    document.querySelector('header').appendChild(img);
    img.src = reader.result
    payload.content = reader.result
    console.log(payload)
  }

  if (!~e.target.files[0].type.indexOf("image")) {
    alert('Nah, this is for images');
  } else {
    reader.readAsDataURL(e.target.files[0]);
  }
}

// spatial noise background
raf(function update(dt) {
  var ptr = 0
    , t = Date.now()
  for(var i=0; i<canvas.width; ++i) {
    for(var j=0; j<canvas.height; ++j) {
      var v = Math.floor(sn(t, i - 256, j - 256) * 255)
      pixels.data[ptr++] = v
      pixels.data[ptr++] = v
      pixels.data[ptr++] = v
      pixels.data[ptr++] = 255
    }
  }
  context.putImageData(pixels, 0, 0)
  if (!killed) raf(update);
});

submitBtn.addEventListener('click', submitHandler);
file.addEventListener('change', fileHandler);

// kill the spatial noise and killswitch glow
killswitch.addEventListener('click', function() {
  killed = true;
  clearInterval(noiseInterval);
});
},{"raf":"/home/meandave/Code/glitch-fork/node_modules/raf/index.js","spatial-noise":"/home/meandave/Code/glitch-fork/node_modules/spatial-noise/prng.js"}]},{},["/home/meandave/Code/glitch-fork/public/js/main.js"])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL21lYW5kYXZlL0NvZGUvZ2xpdGNoLWZvcmsvbm9kZV9tb2R1bGVzL2Jyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsIi9ob21lL21lYW5kYXZlL0NvZGUvZ2xpdGNoLWZvcmsvbm9kZV9tb2R1bGVzL2Jyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL3Byb2Nlc3MvYnJvd3Nlci5qcyIsIi9ob21lL21lYW5kYXZlL0NvZGUvZ2xpdGNoLWZvcmsvbm9kZV9tb2R1bGVzL3JhZi9pbmRleC5qcyIsIi9ob21lL21lYW5kYXZlL0NvZGUvZ2xpdGNoLWZvcmsvbm9kZV9tb2R1bGVzL3JhZi9ub2RlX21vZHVsZXMvcGVyZm9ybWFuY2Utbm93L2xpYi9wZXJmb3JtYW5jZS1ub3cuanMiLCIvaG9tZS9tZWFuZGF2ZS9Db2RlL2dsaXRjaC1mb3JrL25vZGVfbW9kdWxlcy9zcGF0aWFsLW5vaXNlL25vZGVfbW9kdWxlcy9mbG9hdC1iaXRzL2JpdHMuanMiLCIvaG9tZS9tZWFuZGF2ZS9Db2RlL2dsaXRjaC1mb3JrL25vZGVfbW9kdWxlcy9zcGF0aWFsLW5vaXNlL25vZGVfbW9kdWxlcy9oYXNoLWludC9oYXNoaW50LmpzIiwiL2hvbWUvbWVhbmRhdmUvQ29kZS9nbGl0Y2gtZm9yay9ub2RlX21vZHVsZXMvc3BhdGlhbC1ub2lzZS9wcm5nLmpzIiwiL2hvbWUvbWVhbmRhdmUvQ29kZS9nbGl0Y2gtZm9yay9wdWJsaWMvanMvbWFpbi5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQy9EQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDaEZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN0Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDOUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzNFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiLy8gc2hpbSBmb3IgdXNpbmcgcHJvY2VzcyBpbiBicm93c2VyXG5cbnZhciBwcm9jZXNzID0gbW9kdWxlLmV4cG9ydHMgPSB7fTtcblxucHJvY2Vzcy5uZXh0VGljayA9IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGNhblNldEltbWVkaWF0ZSA9IHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnXG4gICAgJiYgd2luZG93LnNldEltbWVkaWF0ZTtcbiAgICB2YXIgY2FuUG9zdCA9IHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnXG4gICAgJiYgd2luZG93LnBvc3RNZXNzYWdlICYmIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyXG4gICAgO1xuXG4gICAgaWYgKGNhblNldEltbWVkaWF0ZSkge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGYpIHsgcmV0dXJuIHdpbmRvdy5zZXRJbW1lZGlhdGUoZikgfTtcbiAgICB9XG5cbiAgICBpZiAoY2FuUG9zdCkge1xuICAgICAgICB2YXIgcXVldWUgPSBbXTtcbiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCBmdW5jdGlvbiAoZXYpIHtcbiAgICAgICAgICAgIHZhciBzb3VyY2UgPSBldi5zb3VyY2U7XG4gICAgICAgICAgICBpZiAoKHNvdXJjZSA9PT0gd2luZG93IHx8IHNvdXJjZSA9PT0gbnVsbCkgJiYgZXYuZGF0YSA9PT0gJ3Byb2Nlc3MtdGljaycpIHtcbiAgICAgICAgICAgICAgICBldi5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICBpZiAocXVldWUubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZm4gPSBxdWV1ZS5zaGlmdCgpO1xuICAgICAgICAgICAgICAgICAgICBmbigpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgdHJ1ZSk7XG5cbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIG5leHRUaWNrKGZuKSB7XG4gICAgICAgICAgICBxdWV1ZS5wdXNoKGZuKTtcbiAgICAgICAgICAgIHdpbmRvdy5wb3N0TWVzc2FnZSgncHJvY2Vzcy10aWNrJywgJyonKTtcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICByZXR1cm4gZnVuY3Rpb24gbmV4dFRpY2soZm4pIHtcbiAgICAgICAgc2V0VGltZW91dChmbiwgMCk7XG4gICAgfTtcbn0pKCk7XG5cbnByb2Nlc3MudGl0bGUgPSAnYnJvd3Nlcic7XG5wcm9jZXNzLmJyb3dzZXIgPSB0cnVlO1xucHJvY2Vzcy5lbnYgPSB7fTtcbnByb2Nlc3MuYXJndiA9IFtdO1xuXG5mdW5jdGlvbiBub29wKCkge31cblxucHJvY2Vzcy5vbiA9IG5vb3A7XG5wcm9jZXNzLmFkZExpc3RlbmVyID0gbm9vcDtcbnByb2Nlc3Mub25jZSA9IG5vb3A7XG5wcm9jZXNzLm9mZiA9IG5vb3A7XG5wcm9jZXNzLnJlbW92ZUxpc3RlbmVyID0gbm9vcDtcbnByb2Nlc3MucmVtb3ZlQWxsTGlzdGVuZXJzID0gbm9vcDtcbnByb2Nlc3MuZW1pdCA9IG5vb3A7XG5cbnByb2Nlc3MuYmluZGluZyA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdwcm9jZXNzLmJpbmRpbmcgaXMgbm90IHN1cHBvcnRlZCcpO1xufVxuXG4vLyBUT0RPKHNodHlsbWFuKVxucHJvY2Vzcy5jd2QgPSBmdW5jdGlvbiAoKSB7IHJldHVybiAnLycgfTtcbnByb2Nlc3MuY2hkaXIgPSBmdW5jdGlvbiAoZGlyKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdwcm9jZXNzLmNoZGlyIGlzIG5vdCBzdXBwb3J0ZWQnKTtcbn07XG4iLCJ2YXIgbm93ID0gcmVxdWlyZSgncGVyZm9ybWFuY2Utbm93JylcbiAgLCBnbG9iYWwgPSB0eXBlb2Ygd2luZG93ID09PSAndW5kZWZpbmVkJyA/IHt9IDogd2luZG93XG4gICwgdmVuZG9ycyA9IFsnbW96JywgJ3dlYmtpdCddXG4gICwgc3VmZml4ID0gJ0FuaW1hdGlvbkZyYW1lJ1xuICAsIHJhZiA9IGdsb2JhbFsncmVxdWVzdCcgKyBzdWZmaXhdXG4gICwgY2FmID0gZ2xvYmFsWydjYW5jZWwnICsgc3VmZml4XSB8fCBnbG9iYWxbJ2NhbmNlbFJlcXVlc3QnICsgc3VmZml4XVxuICAsIG5hdGl2ZSA9IHRydWVcblxuZm9yKHZhciBpID0gMDsgaSA8IHZlbmRvcnMubGVuZ3RoICYmICFyYWY7IGkrKykge1xuICByYWYgPSBnbG9iYWxbdmVuZG9yc1tpXSArICdSZXF1ZXN0JyArIHN1ZmZpeF1cbiAgY2FmID0gZ2xvYmFsW3ZlbmRvcnNbaV0gKyAnQ2FuY2VsJyArIHN1ZmZpeF1cbiAgICAgIHx8IGdsb2JhbFt2ZW5kb3JzW2ldICsgJ0NhbmNlbFJlcXVlc3QnICsgc3VmZml4XVxufVxuXG4vLyBTb21lIHZlcnNpb25zIG9mIEZGIGhhdmUgckFGIGJ1dCBub3QgY0FGXG5pZighcmFmIHx8ICFjYWYpIHtcbiAgbmF0aXZlID0gZmFsc2VcblxuICB2YXIgbGFzdCA9IDBcbiAgICAsIGlkID0gMFxuICAgICwgcXVldWUgPSBbXVxuICAgICwgZnJhbWVEdXJhdGlvbiA9IDEwMDAgLyA2MFxuXG4gIHJhZiA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG4gICAgaWYocXVldWUubGVuZ3RoID09PSAwKSB7XG4gICAgICB2YXIgX25vdyA9IG5vdygpXG4gICAgICAgICwgbmV4dCA9IE1hdGgubWF4KDAsIGZyYW1lRHVyYXRpb24gLSAoX25vdyAtIGxhc3QpKVxuICAgICAgbGFzdCA9IG5leHQgKyBfbm93XG4gICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgY3AgPSBxdWV1ZS5zbGljZSgwKVxuICAgICAgICAvLyBDbGVhciBxdWV1ZSBoZXJlIHRvIHByZXZlbnRcbiAgICAgICAgLy8gY2FsbGJhY2tzIGZyb20gYXBwZW5kaW5nIGxpc3RlbmVyc1xuICAgICAgICAvLyB0byB0aGUgY3VycmVudCBmcmFtZSdzIHF1ZXVlXG4gICAgICAgIHF1ZXVlLmxlbmd0aCA9IDBcbiAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IGNwLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgaWYoIWNwW2ldLmNhbmNlbGxlZCkge1xuICAgICAgICAgICAgdHJ5e1xuICAgICAgICAgICAgICBjcFtpXS5jYWxsYmFjayhsYXN0KVxuICAgICAgICAgICAgfSBjYXRjaChlKSB7XG4gICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7IHRocm93IGUgfSwgMClcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0sIE1hdGgucm91bmQobmV4dCkpXG4gICAgfVxuICAgIHF1ZXVlLnB1c2goe1xuICAgICAgaGFuZGxlOiArK2lkLFxuICAgICAgY2FsbGJhY2s6IGNhbGxiYWNrLFxuICAgICAgY2FuY2VsbGVkOiBmYWxzZVxuICAgIH0pXG4gICAgcmV0dXJuIGlkXG4gIH1cblxuICBjYWYgPSBmdW5jdGlvbihoYW5kbGUpIHtcbiAgICBmb3IodmFyIGkgPSAwOyBpIDwgcXVldWUubGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmKHF1ZXVlW2ldLmhhbmRsZSA9PT0gaGFuZGxlKSB7XG4gICAgICAgIHF1ZXVlW2ldLmNhbmNlbGxlZCA9IHRydWVcbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihmbikge1xuICAvLyBXcmFwIGluIGEgbmV3IGZ1bmN0aW9uIHRvIHByZXZlbnRcbiAgLy8gYGNhbmNlbGAgcG90ZW50aWFsbHkgYmVpbmcgYXNzaWduZWRcbiAgLy8gdG8gdGhlIG5hdGl2ZSByQUYgZnVuY3Rpb25cbiAgaWYoIW5hdGl2ZSkge1xuICAgIHJldHVybiByYWYuY2FsbChnbG9iYWwsIGZuKVxuICB9XG4gIHJldHVybiByYWYuY2FsbChnbG9iYWwsIGZ1bmN0aW9uKCkge1xuICAgIHRyeXtcbiAgICAgIGZuLmFwcGx5KHRoaXMsIGFyZ3VtZW50cylcbiAgICB9IGNhdGNoKGUpIHtcbiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7IHRocm93IGUgfSwgMClcbiAgICB9XG4gIH0pXG59XG5tb2R1bGUuZXhwb3J0cy5jYW5jZWwgPSBmdW5jdGlvbigpIHtcbiAgY2FmLmFwcGx5KGdsb2JhbCwgYXJndW1lbnRzKVxufVxuIiwiKGZ1bmN0aW9uIChwcm9jZXNzKXtcbi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS42LjNcbihmdW5jdGlvbigpIHtcbiAgdmFyIGdldE5hbm9TZWNvbmRzLCBocnRpbWUsIGxvYWRUaW1lO1xuXG4gIGlmICgodHlwZW9mIHBlcmZvcm1hbmNlICE9PSBcInVuZGVmaW5lZFwiICYmIHBlcmZvcm1hbmNlICE9PSBudWxsKSAmJiBwZXJmb3JtYW5jZS5ub3cpIHtcbiAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHBlcmZvcm1hbmNlLm5vdygpO1xuICAgIH07XG4gIH0gZWxzZSBpZiAoKHR5cGVvZiBwcm9jZXNzICE9PSBcInVuZGVmaW5lZFwiICYmIHByb2Nlc3MgIT09IG51bGwpICYmIHByb2Nlc3MuaHJ0aW1lKSB7XG4gICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiAoZ2V0TmFub1NlY29uZHMoKSAtIGxvYWRUaW1lKSAvIDFlNjtcbiAgICB9O1xuICAgIGhydGltZSA9IHByb2Nlc3MuaHJ0aW1lO1xuICAgIGdldE5hbm9TZWNvbmRzID0gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgaHI7XG4gICAgICBociA9IGhydGltZSgpO1xuICAgICAgcmV0dXJuIGhyWzBdICogMWU5ICsgaHJbMV07XG4gICAgfTtcbiAgICBsb2FkVGltZSA9IGdldE5hbm9TZWNvbmRzKCk7XG4gIH0gZWxzZSBpZiAoRGF0ZS5ub3cpIHtcbiAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIERhdGUubm93KCkgLSBsb2FkVGltZTtcbiAgICB9O1xuICAgIGxvYWRUaW1lID0gRGF0ZS5ub3coKTtcbiAgfSBlbHNlIHtcbiAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIG5ldyBEYXRlKCkuZ2V0VGltZSgpIC0gbG9hZFRpbWU7XG4gICAgfTtcbiAgICBsb2FkVGltZSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuICB9XG5cbn0pLmNhbGwodGhpcyk7XG5cbi8qXG4vL0Agc291cmNlTWFwcGluZ1VSTD1wZXJmb3JtYW5jZS1ub3cubWFwXG4qL1xuXG59KS5jYWxsKHRoaXMscmVxdWlyZSgnX3Byb2Nlc3MnKSkiLCJcInVzZSBzdHJpY3RcIlxuXG52YXIgRkxPQVRfVklFVyAgPSBuZXcgRmxvYXQzMkFycmF5KDEpXG4gICwgSU5UX1ZJRVcgICAgPSBuZXcgSW50MzJBcnJheShGTE9BVF9WSUVXLmJ1ZmZlcilcbiAgLCBVSU5UX1ZJRVcgICA9IG5ldyBVaW50MzJBcnJheShGTE9BVF9WSUVXLmJ1ZmZlcilcblxuZnVuY3Rpb24gZmxvYXRUb0ludCh4KSB7XG4gIEZMT0FUX1ZJRVdbMF0gPSB4XG4gIHJldHVybiBJTlRfVklFV1swXVxufVxuXG5mdW5jdGlvbiBpbnRUb0Zsb2F0KHgpIHtcbiAgSU5UX1ZJRVdbMF0gPSB4XG4gIHJldHVybiBGTE9BVF9WSUVXWzBdXG59XG5cbmZ1bmN0aW9uIGZsb2F0VG9VaW50KHgpIHtcbiAgRkxPQVRfVklFV1swXSA9IHhcbiAgcmV0dXJuIFVJTlRfVklFV1swXVxufVxuXG5mdW5jdGlvbiB1aW50VG9GbG9hdCh4KSB7XG4gIFVJTlRfVklFV1swXSA9IHhcbiAgcmV0dXJuIEZMT0FUX1ZJRVdbMF1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBmbG9hdFRvSW50XG5tb2R1bGUuZXhwb3J0cy50b0ludCA9IGZsb2F0VG9JbnRcbm1vZHVsZS5leHBvcnRzLmZyb21JbnQgPSBpbnRUb0Zsb2F0XG5tb2R1bGUuZXhwb3J0cy50b1VpbnQgPSBmbG9hdFRvVWludFxubW9kdWxlLmV4cG9ydHMuZnJvbVVpbnQgPSB1aW50VG9GbG9hdCIsIlwidXNlIHN0cmljdFwiXG5cbnZhciBBXG5pZih0eXBlb2YgVWludDMyQXJyYXkgPT09IHVuZGVmaW5lZCkge1xuICBBID0gWyAwIF1cbn0gZWxzZSB7XG4gIEEgPSBuZXcgVWludDMyQXJyYXkoMSlcbn1cblxuZnVuY3Rpb24gaGFzaEludCh4KSB7XG4gIEFbMF0gID0geHwwXG4gIEFbMF0gLT0gKEFbMF08PDYpXG4gIEFbMF0gXj0gKEFbMF0+Pj4xNylcbiAgQVswXSAtPSAoQVswXTw8OSlcbiAgQVswXSBePSAoQVswXTw8NClcbiAgQVswXSAtPSAoQVswXTw8MylcbiAgQVswXSBePSAoQVswXTw8MTApXG4gIEFbMF0gXj0gKEFbMF0+Pj4xNSlcbiAgcmV0dXJuIEFbMF1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBoYXNoSW50XG4iLCJcInVzZSBzdHJpY3RcIlxuXG52YXIgaGFzaEludCAgICAgICA9IHJlcXVpcmUoXCJoYXNoLWludFwiKVxuICAsIGZsb2F0MkludCAgICAgPSByZXF1aXJlKFwiZmxvYXQtYml0c1wiKS50b0ludFxuICAsIFVJTlRfTUFYICAgICAgPSA0Mjk0OTY3Mjk1LjBcbiAgLCBIQVNIX0NPTlNUQU5UID0gMHg3OTk3Rjg3OVxuICAsIERPVUJMRV9WSUVXICAgPSBuZXcgRmxvYXQ2NEFycmF5KDEpXG4gICwgSU5UX1ZJRVcgICAgICA9IG5ldyBVaW50MzJBcnJheShET1VCTEVfVklFVy5idWZmZXIpXG5cbmZ1bmN0aW9uIGhhc2hEb3VibGUoeCwgeSkge1xuICBET1VCTEVfVklFV1swXSA9ICt4XG4gIHJldHVybiBoYXNoSW50KElOVF9WSUVXWzBdICsgaGFzaEludChJTlRfVklFV1sxXSt5KSlcbn1cblxuZnVuY3Rpb24gbm9pc2UxZih4KSB7XG4gIHJldHVybiAoKyhoYXNoSW50KGZsb2F0MkludCh4KStIQVNIX0NPTlNUQU5UKT4+PjApKSAvIFVJTlRfTUFYXG59XG5cbmZ1bmN0aW9uIG5vaXNlMmYoeCwgeSkge1xuICByZXR1cm4gKCsoaGFzaEludChmbG9hdDJJbnQoeSkraGFzaEludChmbG9hdDJJbnQoeCkrSEFTSF9DT05TVEFOVCkpPj4+MCkpIC8gVUlOVF9NQVhcbn1cblxuZnVuY3Rpb24gbm9pc2UzZih4LHkseikge1xuICByZXR1cm4gKCsoaGFzaEludChmbG9hdDJJbnQoeikraGFzaEludChmbG9hdDJJbnQoeSkraGFzaEludChmbG9hdDJJbnQoeCkrSEFTSF9DT05TVEFOVCkpKT4+PjApKSAvIFVJTlRfTUFYXG59XG5cbmZ1bmN0aW9uIG5vaXNlNGYoeCx5LHosdCkge1xuICByZXR1cm4gKCsoaGFzaEludChmbG9hdDJJbnQodCkraGFzaEludChmbG9hdDJJbnQoeikraGFzaEludChmbG9hdDJJbnQoeSkraGFzaEludChmbG9hdDJJbnQoeCkrSEFTSF9DT05TVEFOVCkpKT4+PjApKSkgLyBVSU5UX01BWFxufVxuXG5mdW5jdGlvbiBub2lzZU5mKCkge1xuICB2YXIgbiA9IGFyZ3VtZW50cy5sZW5ndGhcbiAgICAsIHIgPSBIQVNIX0NPTlNUQU5UXG4gIGZvcih2YXIgaT0wOyBpPG47ICsraSkge1xuICAgIHIgPSBoYXNoSW50KHIgKyBmbG9hdDJJbnQoYXJndW1lbnRzW2ldKSlcbiAgfVxuICByZXR1cm4gKCtyKSAvIFVJTlRfTUFYXG59XG5cbmZ1bmN0aW9uIG5vaXNlMWQoeCkge1xuICByZXR1cm4gKyhoYXNoRG91YmxlKHgsIEhBU0hfQ09OU1RBTlQpPj4+MCkgLyBVSU5UX01BWFxufVxuXG5mdW5jdGlvbiBub2lzZTJkKHgsIHkpIHtcbiAgcmV0dXJuICsoaGFzaERvdWJsZSh5LCBoYXNoRG91YmxlKHgsIEhBU0hfQ09OU1RBTlQpKT4+PjApIC8gVUlOVF9NQVhcbn1cblxuZnVuY3Rpb24gbm9pc2UzZCh4LCB5LCB6KSB7XG4gIHJldHVybiArKGhhc2hEb3VibGUoeiwgaGFzaERvdWJsZSh5LCBoYXNoRG91YmxlKHgsIEhBU0hfQ09OU1RBTlQpKSk+Pj4wKSAvIFVJTlRfTUFYXG59XG5cbmZ1bmN0aW9uIG5vaXNlNGQoeCwgeSwgeiwgdCkge1xuICByZXR1cm4gKyhoYXNoRG91YmxlKHQsIGhhc2hEb3VibGUoeiwgaGFzaERvdWJsZSh5LCBoYXNoRG91YmxlKHgsIEhBU0hfQ09OU1RBTlQpKSkpPj4+MCkgLyBVSU5UX01BWFxufVxuXG5mdW5jdGlvbiBub2lzZU5kKCkge1xuICB2YXIgbiA9IGFyZ3VtZW50cy5sZW5ndGhcbiAgICAsIHIgPSBIQVNIX0NPTlNUQU5UXG4gIGZvcih2YXIgaT0wOyBpPG47ICsraSkge1xuICAgIHIgPSBoYXNoRG91YmxlKGFyZ3VtZW50c1tpXSwgcilcbiAgfVxuICByZXR1cm4gKyhyPj4+MCkgLyBVSU5UX01BWFxufVxuXG5tb2R1bGUuZXhwb3J0cyAgICAgICAgID0gbm9pc2VOZFxubW9kdWxlLmV4cG9ydHMubm9pc2UxZCA9IG5vaXNlMWRcbm1vZHVsZS5leHBvcnRzLm5vaXNlMmQgPSBub2lzZTJkXG5tb2R1bGUuZXhwb3J0cy5ub2lzZTNkID0gbm9pc2UzZFxubW9kdWxlLmV4cG9ydHMubm9pc2U0ZCA9IG5vaXNlNGRcbm1vZHVsZS5leHBvcnRzLm5vaXNlTmQgPSBub2lzZU5kXG5tb2R1bGUuZXhwb3J0cy5ub2lzZTFmID0gbm9pc2UxZlxubW9kdWxlLmV4cG9ydHMubm9pc2UyZiA9IG5vaXNlMmZcbm1vZHVsZS5leHBvcnRzLm5vaXNlM2YgPSBub2lzZTNmXG5tb2R1bGUuZXhwb3J0cy5ub2lzZTRmID0gbm9pc2U0ZlxubW9kdWxlLmV4cG9ydHMubm9pc2VOZiA9IG5vaXNlTmZcbiIsInZhciBzbiA9IHJlcXVpcmUoXCJzcGF0aWFsLW5vaXNlXCIpO1xudmFyIHJhZiA9IHJlcXVpcmUoJ3JhZicpO1xuXG52YXIgZmlsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W3R5cGU9ZmlsZV0nKTtcbnZhciBzdWJtaXRCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc3VibWl0JylcbnZhciBraWxsc3dpdGNoID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmtpbGwnKTtcblxudmFyIGltZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpO1xudmFyIGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIik7XG5jYW52YXMuaWQgPSAnbm9pc2UnO1xuY2FudmFzLndpZHRoID0gd2luZG93LmlubmVyV2lkdGg7XG5jYW52YXMuaGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0O1xuZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChjYW52YXMpXG5cbnZhciBjb250ZXh0ID0gY2FudmFzLmdldENvbnRleHQoXCIyZFwiKVxudmFyIHBpeGVscyA9IGNvbnRleHQuZ2V0SW1hZ2VEYXRhKDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodClcblxudmFyIHBheWxvYWQgPSB7fVxudmFyIGtpbGxlZCA9IGZhbHNlO1xuXG52YXIgbm9pc2VJbnRlcnZhbCA9IHNldEludGVydmFsKGZ1bmN0aW9uKCkge1xuICB2YXIgc3ByZWFkID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpKjIwKTtcbiAga2lsbHN3aXRjaC5zdHlsZVsnYm94LXNoYWRvdyddID0gJzExcHggMnB4IDE1cHggJytzcHJlYWQrJ3B4ICNGRTBDMEMnO1xufSwgNTAwKTtcblxudmFyIHN1Ym1pdEhhbmRsZXIgPSBmdW5jdGlvbihlKXtcbiAgZS5wcmV2ZW50RGVmYXVsdCgpXG4gIHZhciB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKVxuICB4aHIub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24oKXtcbiAgICB2YXIgcGFyc2VkO1xuICAgIGlmICh4aHIucmVhZHlTdGF0ZSA9PT0gNCkge1xuICAgICAgcGFyc2VkID0gSlNPTi5wYXJzZSh4aHIucmVzcG9uc2VUZXh0KVxuICAgICAgaW1nLnNyYyA9IHBhcnNlZC5jb250ZW50O1xuICAgIH1cbiAgfVxuICB4aHIub3BlbignUE9TVCcsICcvc2VydmljZScpXG4gIHhoci5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpXG4gIGlmIChwYXlsb2FkLmNvbnRlbnQpIHhoci5zZW5kKEpTT04uc3RyaW5naWZ5KHBheWxvYWQpKTtcbn1cblxudmFyIGZpbGVIYW5kbGVyID0gZnVuY3Rpb24oZSkge1xuICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKVxuICByZWFkZXIub25sb2FkZW5kID0gZnVuY3Rpb24oKSB7XG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignaGVhZGVyJykuYXBwZW5kQ2hpbGQoaW1nKTtcbiAgICBpbWcuc3JjID0gcmVhZGVyLnJlc3VsdFxuICAgIHBheWxvYWQuY29udGVudCA9IHJlYWRlci5yZXN1bHRcbiAgICBjb25zb2xlLmxvZyhwYXlsb2FkKVxuICB9XG5cbiAgaWYgKCF+ZS50YXJnZXQuZmlsZXNbMF0udHlwZS5pbmRleE9mKFwiaW1hZ2VcIikpIHtcbiAgICBhbGVydCgnTmFoLCB0aGlzIGlzIGZvciBpbWFnZXMnKTtcbiAgfSBlbHNlIHtcbiAgICByZWFkZXIucmVhZEFzRGF0YVVSTChlLnRhcmdldC5maWxlc1swXSk7XG4gIH1cbn1cblxuLy8gc3BhdGlhbCBub2lzZSBiYWNrZ3JvdW5kXG5yYWYoZnVuY3Rpb24gdXBkYXRlKGR0KSB7XG4gIHZhciBwdHIgPSAwXG4gICAgLCB0ID0gRGF0ZS5ub3coKVxuICBmb3IodmFyIGk9MDsgaTxjYW52YXMud2lkdGg7ICsraSkge1xuICAgIGZvcih2YXIgaj0wOyBqPGNhbnZhcy5oZWlnaHQ7ICsraikge1xuICAgICAgdmFyIHYgPSBNYXRoLmZsb29yKHNuKHQsIGkgLSAyNTYsIGogLSAyNTYpICogMjU1KVxuICAgICAgcGl4ZWxzLmRhdGFbcHRyKytdID0gdlxuICAgICAgcGl4ZWxzLmRhdGFbcHRyKytdID0gdlxuICAgICAgcGl4ZWxzLmRhdGFbcHRyKytdID0gdlxuICAgICAgcGl4ZWxzLmRhdGFbcHRyKytdID0gMjU1XG4gICAgfVxuICB9XG4gIGNvbnRleHQucHV0SW1hZ2VEYXRhKHBpeGVscywgMCwgMClcbiAgaWYgKCFraWxsZWQpIHJhZih1cGRhdGUpO1xufSk7XG5cbnN1Ym1pdEJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHN1Ym1pdEhhbmRsZXIpO1xuZmlsZS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBmaWxlSGFuZGxlcik7XG5cbi8vIGtpbGwgdGhlIHNwYXRpYWwgbm9pc2UgYW5kIGtpbGxzd2l0Y2ggZ2xvd1xua2lsbHN3aXRjaC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKCkge1xuICBraWxsZWQgPSB0cnVlO1xuICBjbGVhckludGVydmFsKG5vaXNlSW50ZXJ2YWwpO1xufSk7Il19
