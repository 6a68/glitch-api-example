(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({"/home/meandave/Code/glitch-fork/node_modules/browserify/node_modules/process/browser.js":[function(require,module,exports){
// shim for using process in browser

var process = module.exports = {};

process.nextTick = (function () {
    var canSetImmediate = typeof window !== 'undefined'
    && window.setImmediate;
    var canPost = typeof window !== 'undefined'
    && window.postMessage && window.addEventListener
    ;

    if (canSetImmediate) {
        return function (f) { return window.setImmediate(f) };
    }

    if (canPost) {
        var queue = [];
        window.addEventListener('message', function (ev) {
            var source = ev.source;
            if ((source === window || source === null) && ev.data === 'process-tick') {
                ev.stopPropagation();
                if (queue.length > 0) {
                    var fn = queue.shift();
                    fn();
                }
            }
        }, true);

        return function nextTick(fn) {
            queue.push(fn);
            window.postMessage('process-tick', '*');
        };
    }

    return function nextTick(fn) {
        setTimeout(fn, 0);
    };
})();

process.title = 'browser';
process.browser = true;
process.env = {};
process.argv = [];

function noop() {}

process.on = noop;
process.addListener = noop;
process.once = noop;
process.off = noop;
process.removeListener = noop;
process.removeAllListeners = noop;
process.emit = noop;

process.binding = function (name) {
    throw new Error('process.binding is not supported');
}

// TODO(shtylman)
process.cwd = function () { return '/' };
process.chdir = function (dir) {
    throw new Error('process.chdir is not supported');
};

},{}],"/home/meandave/Code/glitch-fork/node_modules/raf/index.js":[function(require,module,exports){
var now = require('performance-now')
  , global = typeof window === 'undefined' ? {} : window
  , vendors = ['moz', 'webkit']
  , suffix = 'AnimationFrame'
  , raf = global['request' + suffix]
  , caf = global['cancel' + suffix] || global['cancelRequest' + suffix]
  , native = true

for(var i = 0; i < vendors.length && !raf; i++) {
  raf = global[vendors[i] + 'Request' + suffix]
  caf = global[vendors[i] + 'Cancel' + suffix]
      || global[vendors[i] + 'CancelRequest' + suffix]
}

// Some versions of FF have rAF but not cAF
if(!raf || !caf) {
  native = false

  var last = 0
    , id = 0
    , queue = []
    , frameDuration = 1000 / 60

  raf = function(callback) {
    if(queue.length === 0) {
      var _now = now()
        , next = Math.max(0, frameDuration - (_now - last))
      last = next + _now
      setTimeout(function() {
        var cp = queue.slice(0)
        // Clear queue here to prevent
        // callbacks from appending listeners
        // to the current frame's queue
        queue.length = 0
        for(var i = 0; i < cp.length; i++) {
          if(!cp[i].cancelled) {
            try{
              cp[i].callback(last)
            } catch(e) {
              setTimeout(function() { throw e }, 0)
            }
          }
        }
      }, Math.round(next))
    }
    queue.push({
      handle: ++id,
      callback: callback,
      cancelled: false
    })
    return id
  }

  caf = function(handle) {
    for(var i = 0; i < queue.length; i++) {
      if(queue[i].handle === handle) {
        queue[i].cancelled = true
      }
    }
  }
}

module.exports = function(fn) {
  // Wrap in a new function to prevent
  // `cancel` potentially being assigned
  // to the native rAF function
  if(!native) {
    return raf.call(global, fn)
  }
  return raf.call(global, function() {
    try{
      fn.apply(this, arguments)
    } catch(e) {
      setTimeout(function() { throw e }, 0)
    }
  })
}
module.exports.cancel = function() {
  caf.apply(global, arguments)
}

},{"performance-now":"/home/meandave/Code/glitch-fork/node_modules/raf/node_modules/performance-now/lib/performance-now.js"}],"/home/meandave/Code/glitch-fork/node_modules/raf/node_modules/performance-now/lib/performance-now.js":[function(require,module,exports){
(function (process){
// Generated by CoffeeScript 1.6.3
(function() {
  var getNanoSeconds, hrtime, loadTime;

  if ((typeof performance !== "undefined" && performance !== null) && performance.now) {
    module.exports = function() {
      return performance.now();
    };
  } else if ((typeof process !== "undefined" && process !== null) && process.hrtime) {
    module.exports = function() {
      return (getNanoSeconds() - loadTime) / 1e6;
    };
    hrtime = process.hrtime;
    getNanoSeconds = function() {
      var hr;
      hr = hrtime();
      return hr[0] * 1e9 + hr[1];
    };
    loadTime = getNanoSeconds();
  } else if (Date.now) {
    module.exports = function() {
      return Date.now() - loadTime;
    };
    loadTime = Date.now();
  } else {
    module.exports = function() {
      return new Date().getTime() - loadTime;
    };
    loadTime = new Date().getTime();
  }

}).call(this);

/*
//@ sourceMappingURL=performance-now.map
*/

}).call(this,require('_process'))
},{"_process":"/home/meandave/Code/glitch-fork/node_modules/browserify/node_modules/process/browser.js"}],"/home/meandave/Code/glitch-fork/node_modules/spatial-noise/node_modules/float-bits/bits.js":[function(require,module,exports){
"use strict"

var FLOAT_VIEW  = new Float32Array(1)
  , INT_VIEW    = new Int32Array(FLOAT_VIEW.buffer)
  , UINT_VIEW   = new Uint32Array(FLOAT_VIEW.buffer)

function floatToInt(x) {
  FLOAT_VIEW[0] = x
  return INT_VIEW[0]
}

function intToFloat(x) {
  INT_VIEW[0] = x
  return FLOAT_VIEW[0]
}

function floatToUint(x) {
  FLOAT_VIEW[0] = x
  return UINT_VIEW[0]
}

function uintToFloat(x) {
  UINT_VIEW[0] = x
  return FLOAT_VIEW[0]
}

module.exports = floatToInt
module.exports.toInt = floatToInt
module.exports.fromInt = intToFloat
module.exports.toUint = floatToUint
module.exports.fromUint = uintToFloat
},{}],"/home/meandave/Code/glitch-fork/node_modules/spatial-noise/node_modules/hash-int/hashint.js":[function(require,module,exports){
"use strict"

var A
if(typeof Uint32Array === undefined) {
  A = [ 0 ]
} else {
  A = new Uint32Array(1)
}

function hashInt(x) {
  A[0]  = x|0
  A[0] -= (A[0]<<6)
  A[0] ^= (A[0]>>>17)
  A[0] -= (A[0]<<9)
  A[0] ^= (A[0]<<4)
  A[0] -= (A[0]<<3)
  A[0] ^= (A[0]<<10)
  A[0] ^= (A[0]>>>15)
  return A[0]
}

module.exports = hashInt

},{}],"/home/meandave/Code/glitch-fork/node_modules/spatial-noise/prng.js":[function(require,module,exports){
"use strict"

var hashInt       = require("hash-int")
  , float2Int     = require("float-bits").toInt
  , UINT_MAX      = 4294967295.0
  , HASH_CONSTANT = 0x7997F879
  , DOUBLE_VIEW   = new Float64Array(1)
  , INT_VIEW      = new Uint32Array(DOUBLE_VIEW.buffer)

function hashDouble(x, y) {
  DOUBLE_VIEW[0] = +x
  return hashInt(INT_VIEW[0] + hashInt(INT_VIEW[1]+y))
}

function noise1f(x) {
  return (+(hashInt(float2Int(x)+HASH_CONSTANT)>>>0)) / UINT_MAX
}

function noise2f(x, y) {
  return (+(hashInt(float2Int(y)+hashInt(float2Int(x)+HASH_CONSTANT))>>>0)) / UINT_MAX
}

function noise3f(x,y,z) {
  return (+(hashInt(float2Int(z)+hashInt(float2Int(y)+hashInt(float2Int(x)+HASH_CONSTANT)))>>>0)) / UINT_MAX
}

function noise4f(x,y,z,t) {
  return (+(hashInt(float2Int(t)+hashInt(float2Int(z)+hashInt(float2Int(y)+hashInt(float2Int(x)+HASH_CONSTANT)))>>>0))) / UINT_MAX
}

function noiseNf() {
  var n = arguments.length
    , r = HASH_CONSTANT
  for(var i=0; i<n; ++i) {
    r = hashInt(r + float2Int(arguments[i]))
  }
  return (+r) / UINT_MAX
}

function noise1d(x) {
  return +(hashDouble(x, HASH_CONSTANT)>>>0) / UINT_MAX
}

function noise2d(x, y) {
  return +(hashDouble(y, hashDouble(x, HASH_CONSTANT))>>>0) / UINT_MAX
}

function noise3d(x, y, z) {
  return +(hashDouble(z, hashDouble(y, hashDouble(x, HASH_CONSTANT)))>>>0) / UINT_MAX
}

function noise4d(x, y, z, t) {
  return +(hashDouble(t, hashDouble(z, hashDouble(y, hashDouble(x, HASH_CONSTANT))))>>>0) / UINT_MAX
}

function noiseNd() {
  var n = arguments.length
    , r = HASH_CONSTANT
  for(var i=0; i<n; ++i) {
    r = hashDouble(arguments[i], r)
  }
  return +(r>>>0) / UINT_MAX
}

module.exports         = noiseNd
module.exports.noise1d = noise1d
module.exports.noise2d = noise2d
module.exports.noise3d = noise3d
module.exports.noise4d = noise4d
module.exports.noiseNd = noiseNd
module.exports.noise1f = noise1f
module.exports.noise2f = noise2f
module.exports.noise3f = noise3f
module.exports.noise4f = noise4f
module.exports.noiseNf = noiseNf

},{"float-bits":"/home/meandave/Code/glitch-fork/node_modules/spatial-noise/node_modules/float-bits/bits.js","hash-int":"/home/meandave/Code/glitch-fork/node_modules/spatial-noise/node_modules/hash-int/hashint.js"}],"/home/meandave/Code/glitch-fork/public/js/main.js":[function(require,module,exports){
var sn = require("spatial-noise");
var raf = require('raf');

var file = document.querySelector('input[type=file]');
var submitBtn = document.querySelector('.submit')
var killswitch = document.querySelector('.kill');

var img = document.createElement('img');
var canvas = document.createElement("canvas");
canvas.id = 'noise';
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;
document.body.appendChild(canvas)

var context = canvas.getContext("2d")
var pixels = context.getImageData(0, 0, canvas.width, canvas.height)

var payload = {}
var killed = false;

var noiseInterval = setInterval(function() {
  var spread = Math.floor(Math.random()*20);
  killswitch.style['box-shadow'] = '11px 2px 15px '+spread+'px #FE0C0C';
}, 500);

var submitHandler = function(e){
  e.preventDefault()
  var xhr = new XMLHttpRequest()
  xhr.onreadystatechange = function(){
    var parsed;
    if (xhr.readyState === 4) {
      parsed = JSON.parse(xhr.responseText)
      img.src = parsed.content

      var data = _parseB64(parsed.content);
      var arrBuffer = _base64toArrayBuffer(data.base64);
      var blob = new Blob([arrBuffer], {type: data.type});
      img.src = URL.createObjectURL(blob);
    }
  }
  xhr.open('POST', '/service')
  xhr.setRequestHeader('Content-Type', 'application/json')
  if (payload.content) xhr.send(JSON.stringify(payload));
}

var fileHandler = function(e) {
  var reader = new FileReader()
  reader.onloadend = function() {
    document.querySelector('header').appendChild(img);
    img.src = reader.result
    payload.content = reader.result
    console.log(payload)
  }

  if (!~e.target.files[0].type.indexOf("image")) {
    alert('Nah, this is for images');
  } else {
    reader.readAsDataURL(e.target.files[0]);
  }
}

var _base64toArrayBuffer  = function(base64) {
  var binary_string =  window.atob(base64);
  var len = binary_string.length;
  var bytes = new Uint8Array( len );
  for (var i = 0; i < len; i++)        {
    var ascii = binary_string.charCodeAt(i);
    bytes[i] = ascii;
  }
  return bytes.buffer;
}

var _parseB64 = function(b64str) {
  return {
    base64: b64str.substr(b64str.indexOf(',') + 1),
    type: b64str.match(/:([^}]*);/)[1]
  }
}

// spatial noise background
raf(function update(dt) {
  var ptr = 0
    , t = Date.now()
  for(var i=0; i<canvas.width; ++i) {
    for(var j=0; j<canvas.height; ++j) {
      var v = Math.floor(sn(t, i - 256, j - 256) * 255)
      pixels.data[ptr++] = v
      pixels.data[ptr++] = v
      pixels.data[ptr++] = v
      pixels.data[ptr++] = 255
    }
  }
  context.putImageData(pixels, 0, 0)
  if (!killed) raf(update);
});

submitBtn.addEventListener('click', submitHandler);
file.addEventListener('change', fileHandler);

// kill the spatial noise and killswitch glow
killswitch.addEventListener('click', function() {
  killed = true;
  clearInterval(noiseInterval);
});
},{"raf":"/home/meandave/Code/glitch-fork/node_modules/raf/index.js","spatial-noise":"/home/meandave/Code/glitch-fork/node_modules/spatial-noise/prng.js"}]},{},["/home/meandave/Code/glitch-fork/public/js/main.js"])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL21lYW5kYXZlL0NvZGUvZ2xpdGNoLWZvcmsvbm9kZV9tb2R1bGVzL2Jyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsIi9ob21lL21lYW5kYXZlL0NvZGUvZ2xpdGNoLWZvcmsvbm9kZV9tb2R1bGVzL2Jyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL3Byb2Nlc3MvYnJvd3Nlci5qcyIsIi9ob21lL21lYW5kYXZlL0NvZGUvZ2xpdGNoLWZvcmsvbm9kZV9tb2R1bGVzL3JhZi9pbmRleC5qcyIsIi9ob21lL21lYW5kYXZlL0NvZGUvZ2xpdGNoLWZvcmsvbm9kZV9tb2R1bGVzL3JhZi9ub2RlX21vZHVsZXMvcGVyZm9ybWFuY2Utbm93L2xpYi9wZXJmb3JtYW5jZS1ub3cuanMiLCIvaG9tZS9tZWFuZGF2ZS9Db2RlL2dsaXRjaC1mb3JrL25vZGVfbW9kdWxlcy9zcGF0aWFsLW5vaXNlL25vZGVfbW9kdWxlcy9mbG9hdC1iaXRzL2JpdHMuanMiLCIvaG9tZS9tZWFuZGF2ZS9Db2RlL2dsaXRjaC1mb3JrL25vZGVfbW9kdWxlcy9zcGF0aWFsLW5vaXNlL25vZGVfbW9kdWxlcy9oYXNoLWludC9oYXNoaW50LmpzIiwiL2hvbWUvbWVhbmRhdmUvQ29kZS9nbGl0Y2gtZm9yay9ub2RlX21vZHVsZXMvc3BhdGlhbC1ub2lzZS9wcm5nLmpzIiwiL2hvbWUvbWVhbmRhdmUvQ29kZS9nbGl0Y2gtZm9yay9wdWJsaWMvanMvbWFpbi5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQy9EQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDaEZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN0Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDOUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzNFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIi8vIHNoaW0gZm9yIHVzaW5nIHByb2Nlc3MgaW4gYnJvd3NlclxuXG52YXIgcHJvY2VzcyA9IG1vZHVsZS5leHBvcnRzID0ge307XG5cbnByb2Nlc3MubmV4dFRpY2sgPSAoZnVuY3Rpb24gKCkge1xuICAgIHZhciBjYW5TZXRJbW1lZGlhdGUgPSB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJ1xuICAgICYmIHdpbmRvdy5zZXRJbW1lZGlhdGU7XG4gICAgdmFyIGNhblBvc3QgPSB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJ1xuICAgICYmIHdpbmRvdy5wb3N0TWVzc2FnZSAmJiB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lclxuICAgIDtcblxuICAgIGlmIChjYW5TZXRJbW1lZGlhdGUpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChmKSB7IHJldHVybiB3aW5kb3cuc2V0SW1tZWRpYXRlKGYpIH07XG4gICAgfVxuXG4gICAgaWYgKGNhblBvc3QpIHtcbiAgICAgICAgdmFyIHF1ZXVlID0gW107XG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgZnVuY3Rpb24gKGV2KSB7XG4gICAgICAgICAgICB2YXIgc291cmNlID0gZXYuc291cmNlO1xuICAgICAgICAgICAgaWYgKChzb3VyY2UgPT09IHdpbmRvdyB8fCBzb3VyY2UgPT09IG51bGwpICYmIGV2LmRhdGEgPT09ICdwcm9jZXNzLXRpY2snKSB7XG4gICAgICAgICAgICAgICAgZXYuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgaWYgKHF1ZXVlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGZuID0gcXVldWUuc2hpZnQoKTtcbiAgICAgICAgICAgICAgICAgICAgZm4oKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIHRydWUpO1xuXG4gICAgICAgIHJldHVybiBmdW5jdGlvbiBuZXh0VGljayhmbikge1xuICAgICAgICAgICAgcXVldWUucHVzaChmbik7XG4gICAgICAgICAgICB3aW5kb3cucG9zdE1lc3NhZ2UoJ3Byb2Nlc3MtdGljaycsICcqJyk7XG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgcmV0dXJuIGZ1bmN0aW9uIG5leHRUaWNrKGZuKSB7XG4gICAgICAgIHNldFRpbWVvdXQoZm4sIDApO1xuICAgIH07XG59KSgpO1xuXG5wcm9jZXNzLnRpdGxlID0gJ2Jyb3dzZXInO1xucHJvY2Vzcy5icm93c2VyID0gdHJ1ZTtcbnByb2Nlc3MuZW52ID0ge307XG5wcm9jZXNzLmFyZ3YgPSBbXTtcblxuZnVuY3Rpb24gbm9vcCgpIHt9XG5cbnByb2Nlc3Mub24gPSBub29wO1xucHJvY2Vzcy5hZGRMaXN0ZW5lciA9IG5vb3A7XG5wcm9jZXNzLm9uY2UgPSBub29wO1xucHJvY2Vzcy5vZmYgPSBub29wO1xucHJvY2Vzcy5yZW1vdmVMaXN0ZW5lciA9IG5vb3A7XG5wcm9jZXNzLnJlbW92ZUFsbExpc3RlbmVycyA9IG5vb3A7XG5wcm9jZXNzLmVtaXQgPSBub29wO1xuXG5wcm9jZXNzLmJpbmRpbmcgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgIHRocm93IG5ldyBFcnJvcigncHJvY2Vzcy5iaW5kaW5nIGlzIG5vdCBzdXBwb3J0ZWQnKTtcbn1cblxuLy8gVE9ETyhzaHR5bG1hbilcbnByb2Nlc3MuY3dkID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gJy8nIH07XG5wcm9jZXNzLmNoZGlyID0gZnVuY3Rpb24gKGRpcikge1xuICAgIHRocm93IG5ldyBFcnJvcigncHJvY2Vzcy5jaGRpciBpcyBub3Qgc3VwcG9ydGVkJyk7XG59O1xuIiwidmFyIG5vdyA9IHJlcXVpcmUoJ3BlcmZvcm1hbmNlLW5vdycpXG4gICwgZ2xvYmFsID0gdHlwZW9mIHdpbmRvdyA9PT0gJ3VuZGVmaW5lZCcgPyB7fSA6IHdpbmRvd1xuICAsIHZlbmRvcnMgPSBbJ21veicsICd3ZWJraXQnXVxuICAsIHN1ZmZpeCA9ICdBbmltYXRpb25GcmFtZSdcbiAgLCByYWYgPSBnbG9iYWxbJ3JlcXVlc3QnICsgc3VmZml4XVxuICAsIGNhZiA9IGdsb2JhbFsnY2FuY2VsJyArIHN1ZmZpeF0gfHwgZ2xvYmFsWydjYW5jZWxSZXF1ZXN0JyArIHN1ZmZpeF1cbiAgLCBuYXRpdmUgPSB0cnVlXG5cbmZvcih2YXIgaSA9IDA7IGkgPCB2ZW5kb3JzLmxlbmd0aCAmJiAhcmFmOyBpKyspIHtcbiAgcmFmID0gZ2xvYmFsW3ZlbmRvcnNbaV0gKyAnUmVxdWVzdCcgKyBzdWZmaXhdXG4gIGNhZiA9IGdsb2JhbFt2ZW5kb3JzW2ldICsgJ0NhbmNlbCcgKyBzdWZmaXhdXG4gICAgICB8fCBnbG9iYWxbdmVuZG9yc1tpXSArICdDYW5jZWxSZXF1ZXN0JyArIHN1ZmZpeF1cbn1cblxuLy8gU29tZSB2ZXJzaW9ucyBvZiBGRiBoYXZlIHJBRiBidXQgbm90IGNBRlxuaWYoIXJhZiB8fCAhY2FmKSB7XG4gIG5hdGl2ZSA9IGZhbHNlXG5cbiAgdmFyIGxhc3QgPSAwXG4gICAgLCBpZCA9IDBcbiAgICAsIHF1ZXVlID0gW11cbiAgICAsIGZyYW1lRHVyYXRpb24gPSAxMDAwIC8gNjBcblxuICByYWYgPSBmdW5jdGlvbihjYWxsYmFjaykge1xuICAgIGlmKHF1ZXVlLmxlbmd0aCA9PT0gMCkge1xuICAgICAgdmFyIF9ub3cgPSBub3coKVxuICAgICAgICAsIG5leHQgPSBNYXRoLm1heCgwLCBmcmFtZUR1cmF0aW9uIC0gKF9ub3cgLSBsYXN0KSlcbiAgICAgIGxhc3QgPSBuZXh0ICsgX25vd1xuICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGNwID0gcXVldWUuc2xpY2UoMClcbiAgICAgICAgLy8gQ2xlYXIgcXVldWUgaGVyZSB0byBwcmV2ZW50XG4gICAgICAgIC8vIGNhbGxiYWNrcyBmcm9tIGFwcGVuZGluZyBsaXN0ZW5lcnNcbiAgICAgICAgLy8gdG8gdGhlIGN1cnJlbnQgZnJhbWUncyBxdWV1ZVxuICAgICAgICBxdWV1ZS5sZW5ndGggPSAwXG4gICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCBjcC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgIGlmKCFjcFtpXS5jYW5jZWxsZWQpIHtcbiAgICAgICAgICAgIHRyeXtcbiAgICAgICAgICAgICAgY3BbaV0uY2FsbGJhY2sobGFzdClcbiAgICAgICAgICAgIH0gY2F0Y2goZSkge1xuICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgeyB0aHJvdyBlIH0sIDApXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9LCBNYXRoLnJvdW5kKG5leHQpKVxuICAgIH1cbiAgICBxdWV1ZS5wdXNoKHtcbiAgICAgIGhhbmRsZTogKytpZCxcbiAgICAgIGNhbGxiYWNrOiBjYWxsYmFjayxcbiAgICAgIGNhbmNlbGxlZDogZmFsc2VcbiAgICB9KVxuICAgIHJldHVybiBpZFxuICB9XG5cbiAgY2FmID0gZnVuY3Rpb24oaGFuZGxlKSB7XG4gICAgZm9yKHZhciBpID0gMDsgaSA8IHF1ZXVlLmxlbmd0aDsgaSsrKSB7XG4gICAgICBpZihxdWV1ZVtpXS5oYW5kbGUgPT09IGhhbmRsZSkge1xuICAgICAgICBxdWV1ZVtpXS5jYW5jZWxsZWQgPSB0cnVlXG4gICAgICB9XG4gICAgfVxuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oZm4pIHtcbiAgLy8gV3JhcCBpbiBhIG5ldyBmdW5jdGlvbiB0byBwcmV2ZW50XG4gIC8vIGBjYW5jZWxgIHBvdGVudGlhbGx5IGJlaW5nIGFzc2lnbmVkXG4gIC8vIHRvIHRoZSBuYXRpdmUgckFGIGZ1bmN0aW9uXG4gIGlmKCFuYXRpdmUpIHtcbiAgICByZXR1cm4gcmFmLmNhbGwoZ2xvYmFsLCBmbilcbiAgfVxuICByZXR1cm4gcmFmLmNhbGwoZ2xvYmFsLCBmdW5jdGlvbigpIHtcbiAgICB0cnl7XG4gICAgICBmbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpXG4gICAgfSBjYXRjaChlKSB7XG4gICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgeyB0aHJvdyBlIH0sIDApXG4gICAgfVxuICB9KVxufVxubW9kdWxlLmV4cG9ydHMuY2FuY2VsID0gZnVuY3Rpb24oKSB7XG4gIGNhZi5hcHBseShnbG9iYWwsIGFyZ3VtZW50cylcbn1cbiIsIihmdW5jdGlvbiAocHJvY2Vzcyl7XG4vLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuNi4zXG4oZnVuY3Rpb24oKSB7XG4gIHZhciBnZXROYW5vU2Vjb25kcywgaHJ0aW1lLCBsb2FkVGltZTtcblxuICBpZiAoKHR5cGVvZiBwZXJmb3JtYW5jZSAhPT0gXCJ1bmRlZmluZWRcIiAmJiBwZXJmb3JtYW5jZSAhPT0gbnVsbCkgJiYgcGVyZm9ybWFuY2Uubm93KSB7XG4gICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICB9O1xuICB9IGVsc2UgaWYgKCh0eXBlb2YgcHJvY2VzcyAhPT0gXCJ1bmRlZmluZWRcIiAmJiBwcm9jZXNzICE9PSBudWxsKSAmJiBwcm9jZXNzLmhydGltZSkge1xuICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gKGdldE5hbm9TZWNvbmRzKCkgLSBsb2FkVGltZSkgLyAxZTY7XG4gICAgfTtcbiAgICBocnRpbWUgPSBwcm9jZXNzLmhydGltZTtcbiAgICBnZXROYW5vU2Vjb25kcyA9IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGhyO1xuICAgICAgaHIgPSBocnRpbWUoKTtcbiAgICAgIHJldHVybiBoclswXSAqIDFlOSArIGhyWzFdO1xuICAgIH07XG4gICAgbG9hZFRpbWUgPSBnZXROYW5vU2Vjb25kcygpO1xuICB9IGVsc2UgaWYgKERhdGUubm93KSB7XG4gICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiBEYXRlLm5vdygpIC0gbG9hZFRpbWU7XG4gICAgfTtcbiAgICBsb2FkVGltZSA9IERhdGUubm93KCk7XG4gIH0gZWxzZSB7XG4gICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiBuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIGxvYWRUaW1lO1xuICAgIH07XG4gICAgbG9hZFRpbWUgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcbiAgfVxuXG59KS5jYWxsKHRoaXMpO1xuXG4vKlxuLy9AIHNvdXJjZU1hcHBpbmdVUkw9cGVyZm9ybWFuY2Utbm93Lm1hcFxuKi9cblxufSkuY2FsbCh0aGlzLHJlcXVpcmUoJ19wcm9jZXNzJykpIiwiXCJ1c2Ugc3RyaWN0XCJcblxudmFyIEZMT0FUX1ZJRVcgID0gbmV3IEZsb2F0MzJBcnJheSgxKVxuICAsIElOVF9WSUVXICAgID0gbmV3IEludDMyQXJyYXkoRkxPQVRfVklFVy5idWZmZXIpXG4gICwgVUlOVF9WSUVXICAgPSBuZXcgVWludDMyQXJyYXkoRkxPQVRfVklFVy5idWZmZXIpXG5cbmZ1bmN0aW9uIGZsb2F0VG9JbnQoeCkge1xuICBGTE9BVF9WSUVXWzBdID0geFxuICByZXR1cm4gSU5UX1ZJRVdbMF1cbn1cblxuZnVuY3Rpb24gaW50VG9GbG9hdCh4KSB7XG4gIElOVF9WSUVXWzBdID0geFxuICByZXR1cm4gRkxPQVRfVklFV1swXVxufVxuXG5mdW5jdGlvbiBmbG9hdFRvVWludCh4KSB7XG4gIEZMT0FUX1ZJRVdbMF0gPSB4XG4gIHJldHVybiBVSU5UX1ZJRVdbMF1cbn1cblxuZnVuY3Rpb24gdWludFRvRmxvYXQoeCkge1xuICBVSU5UX1ZJRVdbMF0gPSB4XG4gIHJldHVybiBGTE9BVF9WSUVXWzBdXG59XG5cbm1vZHVsZS5leHBvcnRzID0gZmxvYXRUb0ludFxubW9kdWxlLmV4cG9ydHMudG9JbnQgPSBmbG9hdFRvSW50XG5tb2R1bGUuZXhwb3J0cy5mcm9tSW50ID0gaW50VG9GbG9hdFxubW9kdWxlLmV4cG9ydHMudG9VaW50ID0gZmxvYXRUb1VpbnRcbm1vZHVsZS5leHBvcnRzLmZyb21VaW50ID0gdWludFRvRmxvYXQiLCJcInVzZSBzdHJpY3RcIlxuXG52YXIgQVxuaWYodHlwZW9mIFVpbnQzMkFycmF5ID09PSB1bmRlZmluZWQpIHtcbiAgQSA9IFsgMCBdXG59IGVsc2Uge1xuICBBID0gbmV3IFVpbnQzMkFycmF5KDEpXG59XG5cbmZ1bmN0aW9uIGhhc2hJbnQoeCkge1xuICBBWzBdICA9IHh8MFxuICBBWzBdIC09IChBWzBdPDw2KVxuICBBWzBdIF49IChBWzBdPj4+MTcpXG4gIEFbMF0gLT0gKEFbMF08PDkpXG4gIEFbMF0gXj0gKEFbMF08PDQpXG4gIEFbMF0gLT0gKEFbMF08PDMpXG4gIEFbMF0gXj0gKEFbMF08PDEwKVxuICBBWzBdIF49IChBWzBdPj4+MTUpXG4gIHJldHVybiBBWzBdXG59XG5cbm1vZHVsZS5leHBvcnRzID0gaGFzaEludFxuIiwiXCJ1c2Ugc3RyaWN0XCJcblxudmFyIGhhc2hJbnQgICAgICAgPSByZXF1aXJlKFwiaGFzaC1pbnRcIilcbiAgLCBmbG9hdDJJbnQgICAgID0gcmVxdWlyZShcImZsb2F0LWJpdHNcIikudG9JbnRcbiAgLCBVSU5UX01BWCAgICAgID0gNDI5NDk2NzI5NS4wXG4gICwgSEFTSF9DT05TVEFOVCA9IDB4Nzk5N0Y4NzlcbiAgLCBET1VCTEVfVklFVyAgID0gbmV3IEZsb2F0NjRBcnJheSgxKVxuICAsIElOVF9WSUVXICAgICAgPSBuZXcgVWludDMyQXJyYXkoRE9VQkxFX1ZJRVcuYnVmZmVyKVxuXG5mdW5jdGlvbiBoYXNoRG91YmxlKHgsIHkpIHtcbiAgRE9VQkxFX1ZJRVdbMF0gPSAreFxuICByZXR1cm4gaGFzaEludChJTlRfVklFV1swXSArIGhhc2hJbnQoSU5UX1ZJRVdbMV0reSkpXG59XG5cbmZ1bmN0aW9uIG5vaXNlMWYoeCkge1xuICByZXR1cm4gKCsoaGFzaEludChmbG9hdDJJbnQoeCkrSEFTSF9DT05TVEFOVCk+Pj4wKSkgLyBVSU5UX01BWFxufVxuXG5mdW5jdGlvbiBub2lzZTJmKHgsIHkpIHtcbiAgcmV0dXJuICgrKGhhc2hJbnQoZmxvYXQySW50KHkpK2hhc2hJbnQoZmxvYXQySW50KHgpK0hBU0hfQ09OU1RBTlQpKT4+PjApKSAvIFVJTlRfTUFYXG59XG5cbmZ1bmN0aW9uIG5vaXNlM2YoeCx5LHopIHtcbiAgcmV0dXJuICgrKGhhc2hJbnQoZmxvYXQySW50KHopK2hhc2hJbnQoZmxvYXQySW50KHkpK2hhc2hJbnQoZmxvYXQySW50KHgpK0hBU0hfQ09OU1RBTlQpKSk+Pj4wKSkgLyBVSU5UX01BWFxufVxuXG5mdW5jdGlvbiBub2lzZTRmKHgseSx6LHQpIHtcbiAgcmV0dXJuICgrKGhhc2hJbnQoZmxvYXQySW50KHQpK2hhc2hJbnQoZmxvYXQySW50KHopK2hhc2hJbnQoZmxvYXQySW50KHkpK2hhc2hJbnQoZmxvYXQySW50KHgpK0hBU0hfQ09OU1RBTlQpKSk+Pj4wKSkpIC8gVUlOVF9NQVhcbn1cblxuZnVuY3Rpb24gbm9pc2VOZigpIHtcbiAgdmFyIG4gPSBhcmd1bWVudHMubGVuZ3RoXG4gICAgLCByID0gSEFTSF9DT05TVEFOVFxuICBmb3IodmFyIGk9MDsgaTxuOyArK2kpIHtcbiAgICByID0gaGFzaEludChyICsgZmxvYXQySW50KGFyZ3VtZW50c1tpXSkpXG4gIH1cbiAgcmV0dXJuICgrcikgLyBVSU5UX01BWFxufVxuXG5mdW5jdGlvbiBub2lzZTFkKHgpIHtcbiAgcmV0dXJuICsoaGFzaERvdWJsZSh4LCBIQVNIX0NPTlNUQU5UKT4+PjApIC8gVUlOVF9NQVhcbn1cblxuZnVuY3Rpb24gbm9pc2UyZCh4LCB5KSB7XG4gIHJldHVybiArKGhhc2hEb3VibGUoeSwgaGFzaERvdWJsZSh4LCBIQVNIX0NPTlNUQU5UKSk+Pj4wKSAvIFVJTlRfTUFYXG59XG5cbmZ1bmN0aW9uIG5vaXNlM2QoeCwgeSwgeikge1xuICByZXR1cm4gKyhoYXNoRG91YmxlKHosIGhhc2hEb3VibGUoeSwgaGFzaERvdWJsZSh4LCBIQVNIX0NPTlNUQU5UKSkpPj4+MCkgLyBVSU5UX01BWFxufVxuXG5mdW5jdGlvbiBub2lzZTRkKHgsIHksIHosIHQpIHtcbiAgcmV0dXJuICsoaGFzaERvdWJsZSh0LCBoYXNoRG91YmxlKHosIGhhc2hEb3VibGUoeSwgaGFzaERvdWJsZSh4LCBIQVNIX0NPTlNUQU5UKSkpKT4+PjApIC8gVUlOVF9NQVhcbn1cblxuZnVuY3Rpb24gbm9pc2VOZCgpIHtcbiAgdmFyIG4gPSBhcmd1bWVudHMubGVuZ3RoXG4gICAgLCByID0gSEFTSF9DT05TVEFOVFxuICBmb3IodmFyIGk9MDsgaTxuOyArK2kpIHtcbiAgICByID0gaGFzaERvdWJsZShhcmd1bWVudHNbaV0sIHIpXG4gIH1cbiAgcmV0dXJuICsocj4+PjApIC8gVUlOVF9NQVhcbn1cblxubW9kdWxlLmV4cG9ydHMgICAgICAgICA9IG5vaXNlTmRcbm1vZHVsZS5leHBvcnRzLm5vaXNlMWQgPSBub2lzZTFkXG5tb2R1bGUuZXhwb3J0cy5ub2lzZTJkID0gbm9pc2UyZFxubW9kdWxlLmV4cG9ydHMubm9pc2UzZCA9IG5vaXNlM2Rcbm1vZHVsZS5leHBvcnRzLm5vaXNlNGQgPSBub2lzZTRkXG5tb2R1bGUuZXhwb3J0cy5ub2lzZU5kID0gbm9pc2VOZFxubW9kdWxlLmV4cG9ydHMubm9pc2UxZiA9IG5vaXNlMWZcbm1vZHVsZS5leHBvcnRzLm5vaXNlMmYgPSBub2lzZTJmXG5tb2R1bGUuZXhwb3J0cy5ub2lzZTNmID0gbm9pc2UzZlxubW9kdWxlLmV4cG9ydHMubm9pc2U0ZiA9IG5vaXNlNGZcbm1vZHVsZS5leHBvcnRzLm5vaXNlTmYgPSBub2lzZU5mXG4iLCJ2YXIgc24gPSByZXF1aXJlKFwic3BhdGlhbC1ub2lzZVwiKTtcbnZhciByYWYgPSByZXF1aXJlKCdyYWYnKTtcblxudmFyIGZpbGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdpbnB1dFt0eXBlPWZpbGVdJyk7XG52YXIgc3VibWl0QnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnN1Ym1pdCcpXG52YXIga2lsbHN3aXRjaCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5raWxsJyk7XG5cbnZhciBpbWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcbnZhciBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FudmFzXCIpO1xuY2FudmFzLmlkID0gJ25vaXNlJztcbmNhbnZhcy53aWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoO1xuY2FudmFzLmhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodDtcbmRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoY2FudmFzKVxuXG52YXIgY29udGV4dCA9IGNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIilcbnZhciBwaXhlbHMgPSBjb250ZXh0LmdldEltYWdlRGF0YSgwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpXG5cbnZhciBwYXlsb2FkID0ge31cbnZhciBraWxsZWQgPSBmYWxzZTtcblxudmFyIG5vaXNlSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChmdW5jdGlvbigpIHtcbiAgdmFyIHNwcmVhZCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSoyMCk7XG4gIGtpbGxzd2l0Y2guc3R5bGVbJ2JveC1zaGFkb3cnXSA9ICcxMXB4IDJweCAxNXB4ICcrc3ByZWFkKydweCAjRkUwQzBDJztcbn0sIDUwMCk7XG5cbnZhciBzdWJtaXRIYW5kbGVyID0gZnVuY3Rpb24oZSl7XG4gIGUucHJldmVudERlZmF1bHQoKVxuICB2YXIgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KClcbiAgeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uKCl7XG4gICAgdmFyIHBhcnNlZDtcbiAgICBpZiAoeGhyLnJlYWR5U3RhdGUgPT09IDQpIHtcbiAgICAgIHBhcnNlZCA9IEpTT04ucGFyc2UoeGhyLnJlc3BvbnNlVGV4dClcbiAgICAgIGltZy5zcmMgPSBwYXJzZWQuY29udGVudFxuXG4gICAgICB2YXIgZGF0YSA9IF9wYXJzZUI2NChwYXJzZWQuY29udGVudCk7XG4gICAgICB2YXIgYXJyQnVmZmVyID0gX2Jhc2U2NHRvQXJyYXlCdWZmZXIoZGF0YS5iYXNlNjQpO1xuICAgICAgdmFyIGJsb2IgPSBuZXcgQmxvYihbYXJyQnVmZmVyXSwge3R5cGU6IGRhdGEudHlwZX0pO1xuICAgICAgaW1nLnNyYyA9IFVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7XG4gICAgfVxuICB9XG4gIHhoci5vcGVuKCdQT1NUJywgJy9zZXJ2aWNlJylcbiAgeGhyLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJylcbiAgaWYgKHBheWxvYWQuY29udGVudCkgeGhyLnNlbmQoSlNPTi5zdHJpbmdpZnkocGF5bG9hZCkpO1xufVxuXG52YXIgZmlsZUhhbmRsZXIgPSBmdW5jdGlvbihlKSB7XG4gIHZhciByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpXG4gIHJlYWRlci5vbmxvYWRlbmQgPSBmdW5jdGlvbigpIHtcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdoZWFkZXInKS5hcHBlbmRDaGlsZChpbWcpO1xuICAgIGltZy5zcmMgPSByZWFkZXIucmVzdWx0XG4gICAgcGF5bG9hZC5jb250ZW50ID0gcmVhZGVyLnJlc3VsdFxuICAgIGNvbnNvbGUubG9nKHBheWxvYWQpXG4gIH1cblxuICBpZiAoIX5lLnRhcmdldC5maWxlc1swXS50eXBlLmluZGV4T2YoXCJpbWFnZVwiKSkge1xuICAgIGFsZXJ0KCdOYWgsIHRoaXMgaXMgZm9yIGltYWdlcycpO1xuICB9IGVsc2Uge1xuICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGUudGFyZ2V0LmZpbGVzWzBdKTtcbiAgfVxufVxuXG52YXIgX2Jhc2U2NHRvQXJyYXlCdWZmZXIgID0gZnVuY3Rpb24oYmFzZTY0KSB7XG4gIHZhciBiaW5hcnlfc3RyaW5nID0gIHdpbmRvdy5hdG9iKGJhc2U2NCk7XG4gIHZhciBsZW4gPSBiaW5hcnlfc3RyaW5nLmxlbmd0aDtcbiAgdmFyIGJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkoIGxlbiApO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSAgICAgICAge1xuICAgIHZhciBhc2NpaSA9IGJpbmFyeV9zdHJpbmcuY2hhckNvZGVBdChpKTtcbiAgICBieXRlc1tpXSA9IGFzY2lpO1xuICB9XG4gIHJldHVybiBieXRlcy5idWZmZXI7XG59XG5cbnZhciBfcGFyc2VCNjQgPSBmdW5jdGlvbihiNjRzdHIpIHtcbiAgcmV0dXJuIHtcbiAgICBiYXNlNjQ6IGI2NHN0ci5zdWJzdHIoYjY0c3RyLmluZGV4T2YoJywnKSArIDEpLFxuICAgIHR5cGU6IGI2NHN0ci5tYXRjaCgvOihbXn1dKik7LylbMV1cbiAgfVxufVxuXG4vLyBzcGF0aWFsIG5vaXNlIGJhY2tncm91bmRcbnJhZihmdW5jdGlvbiB1cGRhdGUoZHQpIHtcbiAgdmFyIHB0ciA9IDBcbiAgICAsIHQgPSBEYXRlLm5vdygpXG4gIGZvcih2YXIgaT0wOyBpPGNhbnZhcy53aWR0aDsgKytpKSB7XG4gICAgZm9yKHZhciBqPTA7IGo8Y2FudmFzLmhlaWdodDsgKytqKSB7XG4gICAgICB2YXIgdiA9IE1hdGguZmxvb3Ioc24odCwgaSAtIDI1NiwgaiAtIDI1NikgKiAyNTUpXG4gICAgICBwaXhlbHMuZGF0YVtwdHIrK10gPSB2XG4gICAgICBwaXhlbHMuZGF0YVtwdHIrK10gPSB2XG4gICAgICBwaXhlbHMuZGF0YVtwdHIrK10gPSB2XG4gICAgICBwaXhlbHMuZGF0YVtwdHIrK10gPSAyNTVcbiAgICB9XG4gIH1cbiAgY29udGV4dC5wdXRJbWFnZURhdGEocGl4ZWxzLCAwLCAwKVxuICBpZiAoIWtpbGxlZCkgcmFmKHVwZGF0ZSk7XG59KTtcblxuc3VibWl0QnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgc3VibWl0SGFuZGxlcik7XG5maWxlLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGZpbGVIYW5kbGVyKTtcblxuLy8ga2lsbCB0aGUgc3BhdGlhbCBub2lzZSBhbmQga2lsbHN3aXRjaCBnbG93XG5raWxsc3dpdGNoLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gIGtpbGxlZCA9IHRydWU7XG4gIGNsZWFySW50ZXJ2YWwobm9pc2VJbnRlcnZhbCk7XG59KTsiXX0=
